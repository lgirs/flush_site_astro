---
/**
 * HeroBurst.astro
 * Center logo surrounded by a ring of vector images (SVGs) in Flush white.
 * Pass full public paths in `marks` (e.g. "/images/marks/shit.svg").
 * Uses CSS masks so every mark renders in --flush-light regardless of the SVG fill.
 */
interface Props {
  centerLogo?: string;
  marks?: string[];
  maxWidth?: string;
  padX?: string;
  radius?: string;
  size?: string;
  jitter?: number;
}

const {
  centerLogo = "/images/logo-flush-white-orange_vex.png",
  marks = [],
  maxWidth = "1100px",
  padX = "1rem",
  radius = "min(40vw, 460px)",
  size = "clamp(40px, 6.5vw, 86px)",
  jitter = 10,
} = Astro.props as Props;

const total = marks.length || 1;
const ring = marks.map((src, i) => {
  const angle = (i / total) * 360;
  const j = ((i * 37) % (jitter * 2)) - jitter; // small deterministic jitter
  // Encode spaces like "join me.svg" so the mask URL is valid
  const safe = encodeURI(src);
  return { src: safe, angle: angle + j };
});
---
<section class="burst" style={`--mx:${maxWidth}; --px:${padX}; --radius:${radius}; --mark-size:${size};`}>
  <div class="burst__inner">
    <img src={centerLogo} alt="Flush" class="burst__logo" loading="eager" />

    <div class="burst__ring" aria-hidden="true">
      {ring.map((m) => (
        <span class="mark" style={`--angle:${m.angle}deg; --img:url('${m.src}');`} />
      ))}
    </div>
  </div>
</section>

<style>
  .burst { background: var(--flush-black); padding-block: clamp(2.5rem, 8vw, 7rem); }
  .burst__inner{
    max-width: var(--mx);
    margin-inline: auto;
    padding-inline: var(--px);
    position: relative;
    display: grid;
    place-items: center;
    isolation: isolate;
  }

  /* center logo (a bit smaller than the old hero) */
  .burst__logo{
    width: min(36vw, 360px);
    height: auto;
    display: block;
    filter: drop-shadow(0 6px 14px rgba(0,0,0,.45));
    z-index: 1;
  }

  .burst__ring{
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    z-index: 0;
    pointer-events: none;
  }

  /* each mark is tinted Flush white via mask */
  .mark{
    position: absolute;
    width: var(--mark-size);
    height: var(--mark-size);
    background: var(--flush-light);
    filter: drop-shadow(0 8px 18px rgba(0,0,0,.35));
    opacity: .95;

    -webkit-mask-image: var(--img);
    mask-image: var(--img);
    -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat;
    -webkit-mask-position: center;   mask-position: center;
    -webkit-mask-size: contain;      mask-size: contain;

    transform:
      rotate(var(--angle))
      translate(var(--radius))
      rotate(calc(var(--angle) * -1));
    transform-origin: center;
  }

  @media (min-width: 900px){
    .burst__logo{ width: min(28vw, 340px); }
    .mark{ opacity: .92; }
  }
</style>
