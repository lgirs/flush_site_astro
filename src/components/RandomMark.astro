---
/**
 * RandomMark.astro
 * Shows ONE random SVG each load.
 * Vectors should live in: src/assets/marks/*.svg
 *
 * We render a visible <img> (filtered to white) to remove any chance of mask issues.
 * If no vectors are found, a yellow debug badge appears so it's obvious.
 */
const modules = import.meta.glob("../assets/marks/*.svg", {
  import: "default",
  query: "?url",
  eager: true,
});
const markUrls = Object.values(modules) as string[];
const count = markUrls.length;
---

<div class="rm" aria-hidden="true">
  <img class="rm__img" alt="" />
  {count === 0 && <div class="rm__debug">NO VECTORS FOUND (src/assets/marks)</div>}
</div>

<script type="module" data-urls={JSON.stringify(markUrls)}>
  const urls = JSON.parse(document.currentScript.dataset.urls || "[]");
  console.log("[RandomMark] vectors:", urls.length, urls.slice(0, 3));
  const root = document.currentScript.previousElementSibling;
  const img  = root?.querySelector(".rm__img");

  if (Array.isArray(urls) && urls.length && img) {
    const url = urls[Math.floor(Math.random() * urls.length)];
    img.src = url;
    img.loading = "lazy";
    img.decoding = "async";
  }
</script>

<style>
  .rm {
    position: relative;
    display: grid;
    place-items: center;
    width: 100%;
    height: 100%;
  }
  .rm__img {
    width: min(65vmin, 820px);
    height: min(65vmin, 820px);
    object-fit: contain;
    /* Turn any dark SVG white; sits on dark hero bg */
    filter: brightness(0) invert(1);
    opacity: 0.9;
  }

  /* visible diagnostic if no vectors were found */
  .rm__debug {
    position: absolute;
    bottom: 0.5rem;
    left: 0.5rem;
    padding: 0.25rem 0.5rem;
    background: #f5d547;
    color: #0f0d0d;
    font: 600 12px/1.2 system-ui, sans-serif;
    border-radius: 4px;
  }
</style>
