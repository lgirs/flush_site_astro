---
/**
 * SocialFeed.astro
 * Props:
 *  - igProfile?: string
 *  - igPosts?: string[]
 *  - fbPage?: string
 */
const { igProfile = "", igPosts = [], fbPage = "" } = Astro.props;

// Build FB Page Plugin URL (used only after user clicks "Load")
const fbSrc = fbPage
  ? `https://www.facebook.com/plugins/page.php?href=${encodeURIComponent(
      fbPage
    )}&tabs=timeline&width=500&height=600&adapt_container_width=true&hide_cover=false&show_facepile=false&small_header=true`
  : "";
---
<section aria-label="Social">
  <h2>Social</h2>

  <!-- Instagram -->
  <div class="social-block">
    <div class="social-header">
      <span>Instagram</span>
      {igProfile && (
        <a class="button" href={`https://instagram.com/${igProfile}`} target="_blank" rel="noopener">
          Follow @{igProfile}
        </a>
      )}
    </div>

    {igPosts.length === 0 ? (
      <p class="muted">Add Instagram post or reel URLs to show embeds.</p>
    ) : (
      <div class="ig-grid">
        {igPosts.map((url) => (
          <div class="ig-card">
            <blockquote
              class="instagram-media"
              data-instgrm-permalink={url}
              data-instgrm-version="14"
              style="background:#000; border:0; margin:0 auto; max-width:540px; width:100%;"
            ></blockquote>
          </div>
        ))}
      </div>
    )}
  </div>

  <!-- Facebook (click to load to avoid “refused to connect” on some browsers) -->
  <div class="social-block">
    <div class="social-header">
      <span>Facebook</span>
      {fbPage && (
        <a class="button" href={fbPage} target="_blank" rel="noopener">Open Page</a>
      )}
    </div>

    {fbPage ? (
      <div class="fb-wrap">
        <div class="fb-consent" id="fb-consent">
          <p class="muted">For privacy reasons, the Facebook feed loads only when you ask.</p>
          <button class="button" id="fb-load">Load Facebook feed</button>
        </div>
        <iframe
          id="fb-iframe"
          title="Facebook Page Plugin"
          src=""
          width="500"
          height="600"
          style="border:none;overflow:hidden;width:100%;max-width:700px;height:600px;display:none;"
          loading="lazy"
          scrolling="no"
          frameborder="0"
          allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"
        ></iframe>
        <noscript>
          <p><a href={fbPage} target="_blank" rel="noopener">Open Facebook page</a></p>
        </noscript>
      </div>
    ) : (
      <p class="muted">Add your Facebook Page URL to show the timeline.</p>
    )}
  </div>
</section>

<!-- Instagram embed script -->
<script async src="https://www.instagram.com/embed.js"></script>

<!-- Small inline script to load FB only on click -->
<script>
  const btn = document.getElementById('fb-load');
  const iframe = document.getElementById('fb-iframe');
  const consent = document.getElementById('fb-consent');
  if (btn && iframe && consent) {
    btn.addEventListener('click', () => {
      iframe.src = {fbSrc: `${fbSrc}`}.fbSrc; // ensure literal inlined at build
      iframe.style.display = 'block';
      consent.style.display = 'none';
    });
  }
</script>

<style>
  .social-block { margin: 1.25rem 0 2rem; }
  .social-header {
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom: .75rem;
  }
  .social-header span { font-weight:700; letter-spacing:.5px; }
  .muted { opacity:.8; }

  /* Instagram grid: 2 columns on tablets, 3 on desktop */
  .ig-grid {
    display:grid; gap: 1rem;
  }
  @media (min-width: 600px){
    .ig-grid { grid-template-columns: 1fr 1fr; }
  }
  @media (min-width: 980px){
    .ig-grid { grid-template-columns: 1fr 1fr 1fr; }
  }

  /* Make IG cards smaller without hacks: constrain the container, center it */
  .ig-card {
    max-width: 360px;   /* <— smaller than IG’s 540px default */
    margin: 0 auto;
  }

  /* Facebook */
  .fb-wrap { display:grid; place-items:center; gap: .75rem; }
  .fb-consent { text-align:center; }
</style>
