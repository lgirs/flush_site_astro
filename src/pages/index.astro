---
import HomeLayout from "../layouts/HomeLayout.astro";

// Import all mark SVGs from /public/images/marks
// IMPORTANT: Use relative path, not "/public/..."
const modules = import.meta.glob("../../public/images/marks/*.svg", {
  eager: true,
  as: "url",
});
const markUrls = Object.values(modules);
---

<HomeLayout title="Flush" description="Letâ€™s do some entertainment">
  <div class="hero">
    <div class="hero__mark" aria-hidden="true"></div>
    <img class="hero__markImg" alt="" />
  </div>

  <p class="intro">
    Welcome to Flush. This is our space for music, words, and whatever else
    comes along. Stick around and explore.
  </p>

  <!-- Tag cloud component already wired here if present -->
  <!-- Example: <TagCloud /> -->

  <script type="module" data-marks={JSON.stringify(markUrls)}>
    const MARK_URLS = JSON.parse(document.currentScript.dataset.marks || "[]");
    if (Array.isArray(MARK_URLS) && MARK_URLS.length > 0) {
      const pick = () =>
        MARK_URLS[Math.floor(Math.random() * MARK_URLS.length)];
      const url = pick();

      const markEl = document.querySelector(".hero__mark");
      const imgEl = document.querySelector(".hero__markImg");

      if (markEl) {
        markEl.style.maskImage = `url(${url})`;
        markEl.style.webkitMaskImage = `url(${url})`;
        markEl.style.maskRepeat = "no-repeat";
        markEl.style.maskPosition = "center";
        markEl.style.maskSize = "contain";
        markEl.style.webkitMaskRepeat = "no-repeat";
        markEl.style.webkitMaskPosition = "center";
        markEl.style.webkitMaskSize = "contain";
        markEl.style.background = "white"; // makes the mask visible
      }
      if (imgEl) {
        imgEl.src = url;
        imgEl.loading = "lazy";
        imgEl.decoding = "async";
      }
    } else {
      console.warn("[home hero] No mark URLs found");
    }
  </script>

  <style>
    .hero {
      position: relative;
      display: grid;
      place-items: center;
      margin-block: 2rem;
    }
    .hero__mark {
      width: min(60vmin, 720px);
      height: min(60vmin, 720px);
    }
    .hero__markImg {
      position: absolute;
      inset: 0;
      margin: auto;
      width: min(60vmin, 720px);
      height: min(60vmin, 720px);
      object-fit: contain;
      opacity: 0; /* hidden unless mask unsupported */
    }
    @supports not (mask-image: url("")) {
      .hero__mark {
        display: none;
      }
      .hero__markImg {
        opacity: 1;
      }
    }

    .intro {
      font-family: var(--font-body, Montserrat, sans-serif);
      font-size: 1.25rem;
      margin-block: 2rem;
      text-align: center;
      max-width: 42rem;
      margin-inline: auto;
    }
  </style>
</HomeLayout>
